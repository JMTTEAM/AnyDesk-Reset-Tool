;===============================================
; AnyDesk Reset Utility (AutoHotkey v1)
; Author: SoftNest Unlocker 
;===============================================

#SingleInstance Force
#NoEnv
SetBatchLines, -1
SetTitleMatchMode, 2
SetWorkingDir, %A_ScriptDir%

;--------------------------------
; Global Log Variable
;--------------------------------
logText := ""

AddLog(msg) {
    global logText
    FormatTime, now,, yyyy-MM-dd HH:mm:ss
    logText .= now " - " msg "`n"
    GuiControl,, LogBox, %logText%
}

;--------------------------------
; Login GUI
;--------------------------------
Gui, Login:Font, s10, Segoe UI
Gui, Login:Add, Text,, User ID:
Gui, Login:Add, Edit, vUserID w200
Gui, Login:Add, Text,, Password:
Gui, Login:Add, Edit, vUserPass w200 Password
Gui, Login:Add, Button, gCheckLogin w200, Login
Gui, Login:Show,, Login Required
Return

CheckLogin:
Gui, Login:Submit
if (UserID = "admin" && UserPass = "admin")
{
    Gui, Login:Destroy
    Gosub, MainGUI
}
else
{
    MsgBox, 48, Error, Incorrect User ID or Password!
}
Return

;--------------------------------
; Main GUI
;--------------------------------
MainGUI:
Gui, Main:Font, s10, Segoe UI

; Bold Header with larger title for LunTech Support
Gui, Main:Font, s16, Segoe UI Bold
Gui, Main:Add, Text, x10 y10 w610 h30 Center cBlue, LunTech Support
Gui, Main:Font, s10, Segoe UI Bold
Gui, Main:Add, Text, x10 y50 w610 h20 Center, Developed by GSM TANVIR

; Reset font to normal for the rest
Gui, Main:Font, s10, Segoe UI
Gui, Main:Add, Text, x10 y75 w610 h20 Center cGray, Make sure you run this tool as Administrator.

; Buttons on left
Gui, Main:Add, Button, x10 y110 w200 h35 gStartAnyDesk, Start AnyDesk
Gui, Main:Add, Button, x10 y155 w200 h35 gStopAnyDesk, Stop AnyDesk
Gui, Main:Add, Button, x10 y200 w200 h35 gResetAnyDesk, Reset AnyDesk

; Log display on the right using RichEdit for blue text
Gui, Main:Add, Edit, x220 y110 w400 h250 vLogBox ReadOnly -E0x2000 +RichEdit cBlue

; Show GUI
Gui, Main:Show, w640 h380 Center, AnyDesk Reset Tool [Beta]
Return

;--------------------------------
; Open Link
;--------------------------------
OpenLink:
Run, https://luntechsupport.com/
Return

;--------------------------------
; Stop AnyDesk
;--------------------------------
StopAnyDesk:
AddLog("Stopping AnyDesk...")
RunWait, sc stop AnyDesk,, Hide
RunWait, taskkill /f /im "AnyDesk.exe",, Hide
AddLog("AnyDesk stopped successfully.")
MsgBox, 64, Success, AnyDesk stopped successfully!
Return

;--------------------------------
; Start AnyDesk
;--------------------------------
StartAnyDesk:
AddLog("Starting AnyDesk...")
RunWait, sc start AnyDesk,, Hide
if FileExist("C:\\Program Files (x86)\\AnyDesk\\AnyDesk.exe")
{
    Run, "C:\\Program Files (x86)\\AnyDesk\\AnyDesk.exe"
    AddLog("AnyDesk launched.")
}
else if FileExist("C:\\Program Files\\AnyDesk\\AnyDesk.exe")
{
    Run, "C:\\Program Files\\AnyDesk\\AnyDesk.exe"
    AddLog("AnyDesk launched.")
}
else
{
    AddLog("AnyDesk executable not found!")
    MsgBox, 48, Error, AnyDesk executable not found!
}
Return

;--------------------------------
; Reset AnyDesk
;--------------------------------
ResetAnyDesk:
AddLog("Reset process started...")
MsgBox, 36, Confirm, This will delete AnyDesk configuration and reset IDs.`nDo you want to continue?
IfMsgBox, No
    Return

Gosub, StopAnyDesk
Sleep, 1000

EnvGet, allUsersProfile, ALLUSERSPROFILE
EnvGet, appData, APPDATA
EnvGet, tempDir, TEMP

FileDelete, %allUsersProfile%\AnyDesk\service.conf
FileDelete, %appData%\AnyDesk\service.conf
FileCopy, %appData%\AnyDesk\user.conf, %tempDir%\user.conf, 1
AddLog("Config files deleted and user.conf backed up.")

RunWait, xcopy /c /e /h /r /y /i /k "%appData%\AnyDesk\thumbnails" "%tempDir%\thumbnails",, Hide
AddLog("Thumbnails backed up.")

FileDelete, %allUsersProfile%\AnyDesk\*.*
FileDelete, %appData%\AnyDesk\*.*
AddLog("All config files cleared.")

Gosub, StartAnyDesk
Sleep, 3000

Loop
{
    if FileExist(allUsersProfile "\\AnyDesk\\system.conf")
        Break
    Sleep, 500
}

Gosub, StopAnyDesk
FileMove, %tempDir%\user.conf, %appData%\AnyDesk\user.conf, 1
RunWait, xcopy /c /e /h /r /y /i /k "%tempDir%\thumbnails" "%appData%\AnyDesk\thumbnails",, Hide
FileRemoveDir, %tempDir%\thumbnails, 1

AddLog("Configurations restored.")

Gosub, StartAnyDesk
MsgBox, 64, Done, AnyDesk reset completed successfully!
AddLog("Reset completed successfully.")
Return

;--------------------------------
; Exit
;--------------------------------
GuiClose:
ExitApp
